-- VARIABLES
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local RunService = game:GetService("RunService")

-- SETTINGS
local settings = {
    urlEnabled = false,
    fovEnabled = false,
    espEnabled = false
}

-- GUI SETUP
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- MENU FRAME
local Menu = Instance.new("Frame")
Menu.Size = UDim2.new(0, 250, 0, 200)
Menu.Position = UDim2.new(0, 10, 0, 50)
Menu.BackgroundColor3 = Color3.fromRGB(50,50,50)
Menu.Visible = true
Menu.Parent = ScreenGui

-- BUTTON CREATOR FUNCTION
local function createButton(name, posY, toggleVar)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 200, 0, 40)
    btn.Position = UDim2.new(0, 20, 0, posY)
    btn.Text = name .. ": OFF"
    btn.Parent = Menu
    btn.BackgroundColor3 = Color3.fromRGB(100,100,100)

    btn.MouseButton1Click:Connect(function()
        settings[toggleVar] = not settings[toggleVar]
        btn.Text = name .. ": " .. (settings[toggleVar] and "ON" or "OFF")
    end)

    return btn
end

-- CREATE BUTTONS
local urlButton = createButton("URL", 20, "urlEnabled")
local fovButton = createButton("FOV Homing", 70, "fovEnabled")
local espButton = createButton("ESP", 120, "espEnabled")

-- FUNCTION: ESP
local function updateESP()
    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer then
            local char = plr.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                if settings.espEnabled then
                    local billboard = char:FindFirstChild("ESP")
                    if not billboard then
                        billboard = Instance.new("BillboardGui")
                        billboard.Name = "ESP"
                        billboard.Size = UDim2.new(0, 100, 0, 50)
                        billboard.AlwaysOnTop = true
                        billboard.Adornee = char.HumanoidRootPart
                        billboard.Parent = char

                        local label = Instance.new("TextLabel")
                        label.Size = UDim2.new(1,0,1,0)
                        label.BackgroundTransparency = 1
                        label.Text = plr.Name
                        label.TextColor3 = plr.TeamColor.Color -- แดงหรือเขียว
                        label.TextScaled = true
                        label.Parent = billboard
                    else
                        billboard.Enabled = true
                    end
                else
                    local billboard = char:FindFirstChild("ESP")
                    if billboard then
                        billboard.Enabled = false
                    end
                end
            end
        end
    end
end

-- FUNCTION: FOV Homing Bullet
local function fireHomingBullet()
    if not settings.fovEnabled then return end
    local closest = nil
    local minDist = math.huge

    for _, plr in ipairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Team ~= LocalPlayer.Team then
            local char = plr.Character
            if char and char:FindFirstChild("HumanoidRootPart") then
                local dist = (char.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
                if dist < minDist then
                    minDist = dist
                    closest = char.HumanoidRootPart
                end
            end
        end
    end

    if closest then
        -- สร้าง projectile (ตัวอย่าง sphere)
        local bullet = Instance.new("Part")
        bullet.Shape = Enum.PartType.Ball
        bullet.Material = Enum.Material.Neon
        bullet.Color = Color3.fromRGB(255, 0, 0)
        bullet.Size = Vector3.new(1,1,1)
        bullet.CFrame = LocalPlayer.Character.HumanoidRootPart.CFrame
        bullet.Anchored = false
        bullet.CanCollide = false
        bullet.Parent = workspace

        local bodyVelocity = Instance.new("BodyVelocity")
        bodyVelocity.MaxForce = Vector3.new(1e5,1e5,1e5)
        bodyVelocity.Velocity = (closest.Position - bullet.Position).Unit * 100
        bodyVelocity.Parent = bullet

        -- ลบ bullet หลัง 3 วินาที
        game.Debris:AddItem(bullet, 3)
    end
end

-- CONNECTIONS
RunService.RenderStepped:Connect(function()
    updateESP()
end)

Mouse.Button1Down:Connect(function()
    fireHomingBullet()
end)
