-- main.lua (ใช้ได้กับ Love2D: https://love2d.org/)
local targets = {}
local menuOpen = false
local fov = 60 -- องศา
local showRedTeam = true
local showGreenTeam = true

function love.load()
    love.window.setTitle("Aim Trainer - ฝึกทักษะอย่างถูกต้อง!")
    for i = 1, 10 do
        table.insert(targets, {
            x = math.random(50, love.graphics.getWidth() - 50),
            y = math.random(50, love.graphics.getHeight() - 50),
            isDoor = math.random() > 0.5,
            team = math.random() > 0.5 and "red" or "green"
        })
    end
end

function love.update(dt)
    if love.keyboard.isDown("m") then
        menuOpen = not menuOpen
        love.timer.sleep(0.2) -- ป้องกัน toggle เร็วเกิน
    end
end

function love.draw()
    love.graphics.setColor(1, 1, 1)
    love.graphics.print("กด M เพื่อเปิดเมนู", 10, 10)

    -- วาดเป้าหมาย
    for _, t in ipairs(targets) do
        if t.isDoor then
            if t.team == "red" and showRedTeam then
                love.graphics.setColor(1, 0, 0)
            elseif t.team == "green" and showGreenTeam then
                love.graphics.setColor(0, 1, 0)
            else
                love.graphics.setColor(0.5, 0.5, 0.5)
            end
            love.graphics.circle("fill", t.x, t.y, 20)
            
            -- คำนวณระยะห่างจากเมาส์
            local mx, my = love.mouse.getPosition()
            local dx, dy = mx - t.x, my - t.y
            local dist = math.sqrt(dx*dx + dy*dy)
            local angle = math.deg(math.atan2(dy, dx))
            
            -- วาด FOV indicator (ถ้าอยู่ในระยะ)
            if dist < 200 then
                love.graphics.setColor(1, 1, 0, 0.5)
                love.graphics.arc("line", "open", t.x, t.y, 180, 
                    math.rad(angle - fov/2), math.rad(angle + fov/2))
            end
        end
    end

    -- เมนู
    if menuOpen then
        love.graphics.setColor(0, 0, 0, 0.7)
        love.graphics.rectangle("fill", 50, 50, 300, 200)
        love.graphics.setColor(1, 1, 1)
        love.graphics.print("เมนูตั้งค่า", 60, 60)
        love.graphics.print("FOV: " .. fov, 60, 90)
        love.graphics.print("↑↓ เพื่อปรับ FOV", 60, 110)
        love.graphics.print("R: ทีมแดง | G: ทีมเขียว", 60, 130)
    end
end

function love.keypressed(key)
    if menuOpen then
        if key == "up" then fov = math.min(120, fov + 5) end
        if key == "down" then fov = math.max(10, fov - 5) end
        if key == "r" then showRedTeam = not showRedTeam end
        if key == "g" then showGreenTeam = not showGreenTeam end
    end
end
